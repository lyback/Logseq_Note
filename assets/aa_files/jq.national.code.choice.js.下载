(function ($, window, document, undefined) {
    var Constructor = function (ele, opt) {
        this.$ele = ele;
        this.options = $.extend({}, this.defaults, opt);
    };

    Constructor.prototype = {
        defaults: {
            code: 86
        },
        init: function () {
            this.render();
            this.bind();
            this.getNationalCode();
        },
        render: function() {
            this.$ele.empty().append(
                "<div class='tabs-input_wrapper'>" +
                    "<input readonly value='+" + this.options.code + "'/>" +
                    // "<img src='"+ SYXZ.CDN +"/static/images/ico/arrow-top.png' />" +
                    "<img src='"+ SYXZ.CDN +"/static/images/login/arrow-top.png' />" +
                "</div>" +
                "<div class='national-list_wrapper'>" +
                    "<ul>" +
                        "<li>中国大陆 + 86</li>" +
                    "</ul>" +
                "</div>"
            )
        },
        bind: function() {
            $('.national-list_wrapper ul').on('click', 'li', $.proxy(this.choiceNationalCode, this));
        },
        //  获取国际代码列表
        getNationalCode: function() {
            var $this = this;
            $.ajax({
                url: API + 'c=service&a=internalCodeList&d=service',
                tpye: 'GET',
                success: function(res) {
                    if(res.errcode == 0) {
                        $this.renderNationalList(res.data);
                    }
                }
            })
        },
        //  渲染国际代码列表
        renderNationalList: function(data) {
            var str = ''
            for(i = 0, len = data.length; i < len; i++) {
                str += "<li>" + data[i].title + '+' + data[i].code + "</li>"
            }
            $('.national-list_wrapper ul').html(str);
        },
        // 选择国际代码
        choiceNationalCode: function(ev) {
            var e = ev || window.event;
            var code = $(e.target).html().split('+')[1];
            $('.tabs-input_wrapper input').val('+' + code);
        }
    };

    $.fn.setNationalCode = function (options) {
        var nationalCode = new Constructor(this, options);
        return nationalCode.init();
    }

})(jQuery, window, document);
